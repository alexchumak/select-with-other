// Generated by CoffeeScript 1.7.1
(function() {
  jQuery.fn.selectwithother = function() {
    var $;
    $ = jQuery;
    return this.each(function() {
      var processed_menu_filter, select_with_other_container;
      select_with_other_container = $(this);
      processed_menu_filter = function(index, element) {
        var not_processed;
        not_processed = !$(element).prop('_selectwithother_processed');
        $(element).prop('_selectwithother_processed', true);
        return not_processed;
      };
      return $('.dropdown-menu', select_with_other_container).filter(processed_menu_filter).each(function() {
        var checked_button, dropdown, other_radio, other_text, toggle_button, update_text, within_other_option, within_standard_options;
        dropdown = $(this);
        other_radio = $('.other-option input:radio', dropdown);
        other_text = $('.other-option input:text', dropdown);
        checked_button = function() {
          return $('input:radio:checked', select_with_other_container);
        };
        toggle_button = function() {
          return $('.dropdown-toggle', select_with_other_container);
        };
        update_text = function() {
          if (within_other_option()) {
            checked_button().val(other_text.val());
          }
          return $('span:first', toggle_button()).text(checked_button().val());
        };
        within_other_option = function() {
          return checked_button().closest('.other-option', select_with_other_container).length > 0;
        };
        within_standard_options = function(ev) {
          return $(ev.target).is(':radio') && $(ev.target).closest('.list-group', select_with_other_container).length > 0;
        };
        dropdown.click(function(ev) {
          if (!($(ev.target).is(':radio') && within_standard_options(ev))) {
            return ev.stopPropagation();
          }
        });
        select_with_other_container.on('hidden.bs.dropdown', function() {
          return update_text();
        });
        return other_text.focus(function() {
          other_radio.prop('checked', true);
          return update_text();
        }).keypress(function(ev) {
          if (ev.which !== 13) {
            return;
          }
          ev.preventDefault();
          ev.stopPropagation();
          return toggle_button().dropdown('toggle');
        }).keyup(function() {
          return update_text();
        });
      });
    });
  };

}).call(this);
